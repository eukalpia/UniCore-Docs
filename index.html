<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UniCore Documentation</title>
    <meta name="author" content="Умаралиев Равшан Рустамжон угли (eukalpia)">
    <meta name="description" content="Полная документация UniCore API Gateway на Rust: YAML-конфиг, pipeline, примеры, запуск, FAQ, автор eukalpia.">
    <link rel="stylesheet" href="style.css">
    <script>
      function toggleCode(id) {
        var el = document.getElementById(id);
        el.style.display = (el.style.display === 'none') ? 'block' : 'none';
      }
    </script>
</head>
<body>
    <header>
        <h1>UniCore — Unified Concurrency Reactor</h1>
        <nav>
            <a href="#about">О проекте</a>
            <a href="#features">Возможности</a>
            <a href="#yaml">YAML-конфиг</a>
            <a href="#pipeline">Pipeline</a>
            <a href="#actions">Действия</a>
            <a href="#examples">Примеры</a>
            <a href="#faq">FAQ</a>
            <a href="#run">Запуск</a>
        </nav>
    </header>
    <main>
        <section id="about">
            <h2>О проекте</h2>
            <p><b>UniCore</b> (Unified Concurrency Reactor) — профессиональный асинхронный API Gateway на Rust, разработан компанией <b>UniOS</b>. Поддерживает проксирование, балансировку, кэширование, JWT, rate limiting, health-check, горячую перезагрузку и структурированное логирование. <br><br><b>Автор:</b> <a href="https://github.com/eukalpia" target="_blank">Умаралиев Равшан Рустамжон угли (eukalpia)</a></p>
        </section>
        <section id="features">
            <h2>Возможности</h2>
            <ul class="features">
                <li>Проксирование HTTP(S) запросов</li>
                <li>Балансировка нагрузки (round robin, random, ip_hash)</li>
                <li>Кэширование ответов</li>
                <li>Rate limiting (по IP/токену/заголовку)</li>
                <li>JWT-аутентификация (JWKS, файл)</li>
                <li>Health-check backend-ов</li>
                <li>Горячая перезагрузка конфига</li>
                <li>Структурированное логирование</li>
                <li>Гибкая настройка pipeline</li>
                <li>Минимальные зависимости</li>
                <li>Production-ready архитектура</li>
            </ul>
        </section>
        <section id="yaml">
            <h2>YAML-конфиг: структура</h2>
            <pre><code>network:
  listen_address: "127.0.0.1:3000"
  tls:
    cert_path: "cert.pem"
    key_path: "key.pem"

routes:
  - path: "/api"
    match_prefix: true
    methods: [GET, POST, PUT, DELETE]
    pipeline:
      - type: response_cache
        ttl: "30s"
      - type: proxy_pass
        targets:
          - "http://localhost:8080"
          - "http://localhost:8081"
        strategy: round_robin
        health_check:
          path: "/"
          interval: "5s"
          timeout: "2s"
  # ... другие маршруты ...
</code></pre>
            <button onclick="toggleCode('full-yaml')">Показать/Скрыть полный пример</button>
            <pre id="full-yaml" style="display:none;"><code>network:
  listen_address: "127.0.0.1:3000"
  tls:
    cert_path: "cert.pem"
    key_path: "key.pem"

routes:
  - path: "/api"
    match_prefix: true
    methods: [GET, POST, PUT, DELETE]
    pipeline:
      - type: response_cache
        ttl: "30s"
      - type: proxy_pass
        targets:
          - "http://localhost:8080"
          - "http://localhost:8081"
        strategy: round_robin
        health_check:
          path: "/"
          interval: "5s"
          timeout: "2s"
  - path: "/limited"
    methods: [GET]
    pipeline:
      - type: rate_limit
        by: ip
        limit: 10
        window: "1m"
      - type: return_response
        status: 200
        body: "You are within the rate limit!"
  - path: "/benchmark"
    methods: [GET]
    pipeline:
      - type: return_response
        status: 200
        body: "OK"
  - path: "/protected"
    methods: [GET]
    pipeline:
      - type: jwt_auth
        jwks_file: "./jwks.json"
        issuer: "my-local-issuer"
        audience: "unicore-local-api"
      - type: return_response
        status: 200
        headers:
          Content-Type: "application/json; charset=utf-8"
        body: '{"message": "Welcome, authenticated user!", "subject": "${auth.claims.sub}"}'
</code></pre>
        </section>
        <section id="pipeline">
            <h2>Pipeline: Общая схема</h2>
            <p>Pipeline — это последовательность действий (actions), которые выполняются для каждого запроса. Действия выполняются сверху вниз. <br> <b>Pipeline поддерживает:</b> проксирование, кэш, лимиты, аутентификацию, логику возврата, работу с заголовками, статику и счётчики.</p>
            <img src="https://raw.githubusercontent.com/egorovdmitry/UniCore/main/docs/pipeline_scheme.svg" alt="Pipeline схема" style="max-width:100%;margin:16px 0;">
        </section>
        <section id="actions">
            <h2>Действия pipeline (actions)</h2>
            <table class="actions">
                <tr><th>type</th><th>Описание</th><th>Параметры</th></tr>
                <tr><td>proxy_pass</td><td>Проксирование на backend-ы</td><td>targets, strategy, health_check</td></tr>
                <tr><td>response_cache</td><td>Кэширование ответов</td><td>ttl</td></tr>
                <tr><td>rate_limit</td><td>Ограничение запросов</td><td>by, limit, window</td></tr>
                <tr><td>jwt_auth</td><td>JWT-аутентификация</td><td>jwks_file/jwks_url, issuer, audience</td></tr>
                <tr><td>return_response</td><td>Статический ответ</td><td>status, headers, body</td></tr>
                <tr><td>increment_counter</td><td>Счётчик посещений</td><td>key</td></tr>
                <tr><td>rewrite_headers</td><td>Изменение/удаление заголовков</td><td>set, remove</td></tr>
                <tr><td>serve_static</td><td>Отдача статических файлов</td><td>root, strip_prefix</td></tr>
            </table>
            <p>Каждое действие можно комбинировать с другими для построения сложных сценариев обработки.</p>
        </section>
        <section id="examples">
            <h2>Примеры конфигов</h2>
            <h3>Минимальный конфиг</h3>
            <pre><code>network:
  listen_address: "127.0.0.1:3000"
routes:
  - path: "/"
    methods: [GET]
    pipeline:
      - type: return_response
        status: 200
        body: "Hello, world!"
</code></pre>
            <h3>JWT-защищённый маршрут</h3>
            <pre><code>- path: "/protected"
  methods: [GET]
  pipeline:
    - type: jwt_auth
      jwks_file: "./jwks.json"
      issuer: "my-local-issuer"
      audience: "unicore-local-api"
    - type: return_response
      status: 200
      headers:
        Content-Type: "application/json; charset=utf-8"
      body: '{"message": "Welcome, authenticated user!", "subject": "${auth.claims.sub}"}'
</code></pre>
            <h3>Кэширование и балансировка</h3>
            <pre><code>- path: "/api"
  match_prefix: true
  methods: [GET, POST]
  pipeline:
    - type: response_cache
      ttl: "10s"
    - type: proxy_pass
      targets:
        - "http://localhost:8080"
        - "http://localhost:8081"
      strategy: random
</code></pre>
        </section>
        <section id="faq">
            <h2>FAQ</h2>
            <details><summary>Как работает hot reload?</summary>
                <div>Любое изменение <b>unicore.yaml</b> автоматически применяется без перезапуска сервера.</div>
            </details>
            <details><summary>Как добавить свой action?</summary>
                <div>Добавьте новый тип в enum Action в Rust-коде и реализуйте обработку в pipeline_processor.rs.</div>
            </details>
            <details><summary>Какой максимальный RPS?</summary>
                <div>Зависит от железа и ОС. На Linux UniCore может выдавать десятки тысяч RPS на простых маршрутах.</div>
            </details>
            <details><summary>Где взять примеры для production?</summary>
                <div>См. <a href="#examples">раздел примеров</a> и <b>README.md</b> репозитория.</div>
            </details>
            <details><summary>Как работает переменные в body/headers?</summary>
                <div>Можно использовать <code>${counter.key.new_value}</code>, <code>${auth.claims.sub}</code>, <code>${header.X-My-Header}</code> для динамических значений.</div>
            </details>
            <details><summary>Как добавить TLS?</summary>
                <div>Укажите <b>tls</b> в секции <b>network</b> с путями к сертификату и ключу.</div>
            </details>
            <details><summary>Как логировать запросы?</summary>
                <div>Включено по умолчанию через <b>tracing</b>. Можно настроить вывод в файл в main.rs.</div>
            </details>
        </section>
        <section id="run">
            <h2>Запуск UniCore</h2>
            <ol>
                <li>Установите Rust: <a href="https://rustup.rs/">https://rustup.rs/</a></li>
                <li>Соберите проект: <code>cargo build --release</code></li>
                <li>Запустите: <code>cargo run --release</code></li>
                <li>Изменения в <b>unicore.yaml</b> применяются на лету (hot reload).</li>
            </ol>
        </section>
    </main>
    <footer>
        <p>UniCore &copy; 2025. Компания <b>UniOS</b>. Автор: <a href="https://github.com/eukalpia" target="_blank">Умаралиев Равшан Рустамжон угли (eukalpia)</a>. Документация для GitHub Pages.</p>
    </footer>
</body>
</html>
